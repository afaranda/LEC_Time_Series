dl
dl<-c(
"/home/adam/Documents/LTS_Data/DBI_NoTrim_HTSeq_Count_Gene",
"/home/adam/Documents/LTS_Data/DNA_Link_NoTrim_HTSeq_Count_Gene"
)
hc_getFileTable <-function(
dirList, pattern='GeneCount.txt',
filename="DataFileAnnotations.csv"
){
if(filename %in% list.files()){
ft<-read.csv(filename)
}
else{
ft<-data.frame(
directory=character(),
filename=character(),
stringsAsFactors=F
)
for (d in dirList){
list.files(d, pattern)
x<-data.frame(
directory = d,
filename = list.files(d, pattern),
stringsAsFactors=F
)
ft<-rbind(ft, x)
}
write.csv(ft, filename, row.names=F)
}
return(ft)
}
hc_loadFiles<-function(ft){
dataSets<-list()
for(i in 1:nrow(ft)){
file<-paste(ft[i,1], ft[i,2], sep='/')
print(file)
dataSets[[file]]<-read.table(
file, header=F, stringsAsFactors=F, sep='\t'
)
}
dataSets
}
# Check Identifier Consistency by iterating over each datafile
hc_identifierConsistency<-function(ds, ft, idCol=1){
ft$rowCount<-0
ft$uniqueID<-0
check<-ds[[1]][,idCol]
for (i in 1:nrow(ft)){
sample<-paste(ft[i,1], ft[i,2], sep='/')
ft$rowCount<-nrow(ds[[sample]])
ft$uniqueID<-length(
unique(
ds[[sample]][,idCol]
)
)
if (sum(check != ds[[sample]][,idCol]) > 0){
print(paste("ID mismatch between first sample and:", sample))
}
}
ft
}
# Join count data columns into a matrix
hc_buildDataFrame<-function(ds, ft, idCol=1){
ft$Sample_Number <-''
df<-data.frame(Ensembl=ds[[1]][,idCol], stringsAsFactors=F)
for( i in 1:nrow(ft)){
sample<-paste(ft[i,1], ft[i,2], sep='/')
if(!any(df$Ensembl != ds[[sample]][,idCol])){
df<-merge(df, ds[[sample]],
by.x='Ensembl', by.y=1,
sort = F)
names(df)[grep('V2', names(df))]<-paste("Sample_", i, sep='')
ft$Sample_Number[i]<-paste("Sample_", i, sep='')
}
else{
print(sum(df$Ensembl != ds[[sample]][,idCol]))
print(paste("Can't join sample:",sample, "ID Mismatch" ))
}
}
list(ft, df[order(df[,idCol]),])
}
ft<-hc_getFileTable(dl)
ds<-hc_loadFiles(ft)
ft<-hc_identifierConsistency(ds, ft)
raw<-hc_buildDataFrame(ds, ft)
# Created: April 30, 2019                                                       #
# Changes:                                                                      #
#         18Jun2019                                                             #
#          - Add functionality for processing StringTie results                 #
#          - update function names to distinguish htseq methods from stringtie  #
#          - functions prefixed with "hc_" process htseq-count data             #
#          - functions prefixed with "st_" process stringtie data               #
#                                                                               #
# Author: Adam Faranda                                                          #
#################################################################################
library(ballgown)
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/ALL_NoTrim_StringTie')
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/ALL_NoTrim_StringTie', samplePattern=*)
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/ALL_NoTrim_StringTie', samplePattern="*")
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/DBI_NoTrim_StringTie', samplePattern="S")
bg
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/DNA_Link_NoTrim_StringTie', samplePattern="*")
bg<-ballgown(dataDir='/home/adam/Documents/LTS_Data/DBI_NoTrim_StringTie', samplePattern="*")
